<head>
  <script
    type="text/javascript"
    src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"
  ></script>
<!-- 
  1. face-api.js 모델 다운로드 
      git clone https://github.com/justadudewhohacks/face-api.js.git
  2. cd face-api.js/examples/examples-browser
      npm i
      npm start
      ///node를 쓸지 browser를 쓸지에 따라 다른 폴더에서 install
  3. 루트폴더에서 face-api 모듈 다운로드
      npm i face-api.js
  4. 다운받은 face-api 모듈 import...min.js 사용해도 된다..비교해보자
  5. 루프 돌려서 faceExpressionResult 단위시간마다 출력
   -->
  <script type="text/javascript" src="./face-api.js/dist/face-api.min.js"></script>
</head>
<body>
  <video id="webcam" autoplay playsinline></video>
  <canvas id="canvas" class="d-none"></canvas>

  <script>
    const webcamElement = document.getElementById("webcam");
    const canvasElement = document.getElementById("canvas");
    const webcam = new Webcam(webcamElement, "user");

    webcam
      .start()
      .then((result) => {
        console.log("webcam started");
      })
      .catch((err) => {
        console.log(err);
      });

    const MODEL_URL = './face-api.js/weights'
    const detector = async () => {
      const minConfidenceFace = 0.5;
      const detectionNet = faceapi.nets.ssdMobilenetv1;
      await detectionNet.load(MODEL_URL);
      await faceapi.loadFaceExpressionModel(MODEL_URL);
      await faceapi.loadFaceLandmarkModel(MODEL_URL);
      
      const expressionResult = await faceapi.detectSingleFace(webcamElement, new faceapi.SsdMobilenetv1Options({ minConfidenceFace })).withFaceExpressions();
      const landmarkResult = await faceapi.detectSingleFace(webcamElement, new faceapi.SsdMobilenetv1Options({ minConfidenceFace })).withFaceLandmarks();
      const expressionFiltered = Object.fromEntries(Object.entries(expressionResult.expressions).filter(([key, score]) => score > minConfidenceFace).sort((a, b) => b[1] - a[1]));

      console.log(expressionFiltered);
    }
    const loop = () => {
      setInterval(async() => {
        await detector();
        let time = new Date();
        console.log("time",time.getSeconds());
      },1000);
    }
    loop();
  </script>
</body>
